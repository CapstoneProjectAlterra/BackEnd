<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StockService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">vaccine-booking-system</a> &gt; <a href="index.source.html" class="el_package">com.backend.vaccinebookingsystem.service</a> &gt; <span class="el_source">StockService.java</span></div><h1>StockService.java</h1><pre class="source lang-java linenums">package com.backend.vaccinebookingsystem.service;

import com.backend.vaccinebookingsystem.constant.AppConstant;
import com.backend.vaccinebookingsystem.domain.dao.FacilityVaccineDao;
import com.backend.vaccinebookingsystem.domain.dao.HealthFacilityDao;
import com.backend.vaccinebookingsystem.domain.dao.VaccineTypeDao;
import com.backend.vaccinebookingsystem.domain.dto.*;
import com.backend.vaccinebookingsystem.repository.HealthFacilityRepository;
import com.backend.vaccinebookingsystem.repository.StockRepository;
import com.backend.vaccinebookingsystem.repository.VaccineTypeRepository;
import com.backend.vaccinebookingsystem.util.ResponseUtil;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

<span class="fc" id="L23">@Slf4j</span>
@Service
<span class="fc" id="L25">public class StockService {</span>

    @Autowired
    private StockRepository stockRepository;

    @Autowired
    private HealthFacilityRepository healthFacilityRepository;

    @Autowired
    private VaccineTypeRepository vaccineTypeRepository;

    public ResponseEntity&lt;Object&gt; createStock(FacilityVaccineDto facilityVaccineDto) {
        try {
<span class="fc" id="L38">            log.info(&quot;Creating new Stock&quot;);</span>
<span class="fc" id="L39">            Optional&lt;FacilityVaccineDao&gt; optionalFacilityVaccineDao = stockRepository.findByFacilityIdAndAndVaccineId(facilityVaccineDto.getFacilityId(), facilityVaccineDto.getVaccineId());</span>

<span class="pc bpc" id="L41" title="1 of 2 branches missed.">            if (optionalFacilityVaccineDao.isPresent()) {</span>
<span class="fc" id="L42">                log.info(&quot;Stock already exists&quot;);</span>
<span class="fc" id="L43">                FacilityVaccineDao facilityVaccineDao = optionalFacilityVaccineDao.get();</span>
<span class="fc" id="L44">                facilityVaccineDao.setStock(facilityVaccineDto.getStock());</span>
<span class="fc" id="L45">                stockRepository.save(facilityVaccineDao);</span>

<span class="fc" id="L47">                FacilityVaccineDto vaccineDto = FacilityVaccineDto.builder()</span>
<span class="fc" id="L48">                        .facilityId(optionalFacilityVaccineDao.get().getFacilityId())</span>
<span class="fc" id="L49">                        .vaccineId(optionalFacilityVaccineDao.get().getVaccineId())</span>
<span class="fc" id="L50">                        .stock(facilityVaccineDao.getStock())</span>
<span class="fc" id="L51">                        .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L52">                                .id(optionalFacilityVaccineDao.get().getFacility().getId())</span>
<span class="fc" id="L53">                                .facilityName(optionalFacilityVaccineDao.get().getFacility().getFacilityName())</span>
<span class="fc" id="L54">                                .streetName(optionalFacilityVaccineDao.get().getFacility().getStreetName())</span>
<span class="fc" id="L55">                                .officeNumber(optionalFacilityVaccineDao.get().getFacility().getOfficeNumber())</span>
<span class="fc" id="L56">                                .villageName(optionalFacilityVaccineDao.get().getFacility().getVillageName())</span>
<span class="fc" id="L57">                                .district(optionalFacilityVaccineDao.get().getFacility().getDistrict())</span>
<span class="fc" id="L58">                                .city(optionalFacilityVaccineDao.get().getFacility().getCity())</span>
<span class="fc" id="L59">                                .province(optionalFacilityVaccineDao.get().getFacility().getProvince())</span>
<span class="fc" id="L60">                                .postalCode(optionalFacilityVaccineDao.get().getFacility().getPostalCode())</span>
<span class="fc" id="L61">                                .image(HealthFacilityImageDto.builder()</span>
<span class="fc" id="L62">                                        .facilityId(optionalFacilityVaccineDao.get().getFacility().getImage().getFacilityId())</span>
<span class="fc" id="L63">                                        .base64(optionalFacilityVaccineDao.get().getFacility().getImage().getBase64())</span>
<span class="fc" id="L64">                                        .contentType(optionalFacilityVaccineDao.get().getFacility().getImage().getContentType())</span>
<span class="fc" id="L65">                                        .build())</span>
<span class="fc" id="L66">                                .profile(ProfileDto.builder()</span>
<span class="fc" id="L67">                                        .userId(optionalFacilityVaccineDao.get().getFacility().getProfile().getUserId())</span>
<span class="fc" id="L68">                                        .role(optionalFacilityVaccineDao.get().getFacility().getProfile().getRole())</span>
<span class="fc" id="L69">                                        .build())</span>
<span class="fc" id="L70">                                .build())</span>
<span class="fc" id="L71">                        .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L72">                                .id(optionalFacilityVaccineDao.get().getVaccine().getId())</span>
<span class="fc" id="L73">                                .vaccineName(optionalFacilityVaccineDao.get().getVaccine().getVaccineName())</span>
<span class="fc" id="L74">                                .build())</span>
<span class="fc" id="L75">                        .build();</span>
<span class="fc" id="L76">                return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, vaccineDto, HttpStatus.OK);</span>
            }

<span class="nc" id="L79">            log.info(&quot;New Stock&quot;);</span>
<span class="nc" id="L80">            Optional&lt;HealthFacilityDao&gt; optionalHealthFacilityDao = healthFacilityRepository.findById(facilityVaccineDto.getFacilityId());</span>
<span class="nc" id="L81">            Optional&lt;VaccineTypeDao&gt; optionalVaccineTypeDao = vaccineTypeRepository.findById(facilityVaccineDto.getVaccineId());</span>

<span class="nc bnc" id="L83" title="All 4 branches missed.">            if (optionalHealthFacilityDao.isEmpty() || optionalVaccineTypeDao.isEmpty()) {</span>
<span class="nc" id="L84">                log.info(&quot;Not Found&quot;);</span>
<span class="nc" id="L85">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="nc" id="L88">            log.info(&quot;Found&quot;);</span>
<span class="nc" id="L89">            FacilityVaccineDao facilityVaccineDao = FacilityVaccineDao.builder()</span>
<span class="nc" id="L90">                    .facilityId(facilityVaccineDto.getFacilityId())</span>
<span class="nc" id="L91">                    .vaccineId(facilityVaccineDto.getVaccineId())</span>
<span class="nc" id="L92">                    .stock(facilityVaccineDto.getStock())</span>
<span class="nc" id="L93">                    .build();</span>

<span class="nc" id="L95">            stockRepository.save(facilityVaccineDao);</span>

<span class="nc" id="L97">            FacilityVaccineDto vaccineDto = FacilityVaccineDto.builder()</span>
<span class="nc" id="L98">                    .facilityId(facilityVaccineDao.getFacilityId())</span>
<span class="nc" id="L99">                    .vaccineId(facilityVaccineDao.getVaccineId())</span>
<span class="nc" id="L100">                    .stock(facilityVaccineDao.getStock())</span>
<span class="nc" id="L101">                    .facility(HealthFacilityDto.builder()</span>
<span class="nc" id="L102">                            .id(optionalHealthFacilityDao.get().getId())</span>
<span class="nc" id="L103">                            .facilityName(optionalHealthFacilityDao.get().getFacilityName())</span>
<span class="nc" id="L104">                            .streetName(optionalHealthFacilityDao.get().getStreetName())</span>
<span class="nc" id="L105">                            .officeNumber(optionalHealthFacilityDao.get().getOfficeNumber())</span>
<span class="nc" id="L106">                            .villageName(optionalHealthFacilityDao.get().getVillageName())</span>
<span class="nc" id="L107">                            .district(optionalHealthFacilityDao.get().getDistrict())</span>
<span class="nc" id="L108">                            .city(optionalHealthFacilityDao.get().getCity())</span>
<span class="nc" id="L109">                            .province(optionalHealthFacilityDao.get().getProvince())</span>
<span class="nc" id="L110">                            .postalCode(optionalHealthFacilityDao.get().getPostalCode())</span>
<span class="nc" id="L111">                            .image(HealthFacilityImageDto.builder()</span>
<span class="nc" id="L112">                                    .facilityId(optionalHealthFacilityDao.get().getImage().getFacilityId())</span>
<span class="nc" id="L113">                                    .base64(optionalHealthFacilityDao.get().getImage().getBase64())</span>
<span class="nc" id="L114">                                    .contentType(optionalHealthFacilityDao.get().getImage().getContentType())</span>
<span class="nc" id="L115">                                    .build())</span>
<span class="nc" id="L116">                            .profile(ProfileDto.builder()</span>
<span class="nc" id="L117">                                    .userId(optionalHealthFacilityDao.get().getProfile().getUserId())</span>
<span class="nc" id="L118">                                    .role(optionalHealthFacilityDao.get().getProfile().getRole())</span>
<span class="nc" id="L119">                                    .build())</span>
<span class="nc" id="L120">                            .build())</span>
<span class="nc" id="L121">                    .vaccine(VaccineTypeDto.builder()</span>
<span class="nc" id="L122">                            .id(optionalVaccineTypeDao.get().getId())</span>
<span class="nc" id="L123">                            .vaccineName(optionalVaccineTypeDao.get().getVaccineName())</span>
<span class="nc" id="L124">                            .build())</span>
<span class="nc" id="L125">                    .build();</span>

<span class="nc" id="L127">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, vaccineDto, HttpStatus.OK);</span>
<span class="nc" id="L128">        } catch (Exception e) {</span>
<span class="nc" id="L129">            log.error(&quot;An error occurred in creating new Stock. Error: {}&quot;, e.getMessage());</span>
<span class="nc" id="L130">            throw e;</span>
        }
    }

    @Transactional
    public ResponseEntity&lt;Object&gt; searchStockById(Long facilityId, Long vaccineId) {
        try {
<span class="fc" id="L137">            log.info(&quot;Getting a Stock by id&quot;);</span>
<span class="fc" id="L138">            Optional&lt;FacilityVaccineDao&gt; optionalFacilityVaccineDao = stockRepository.findByFacilityIdAndAndVaccineId(facilityId, vaccineId);</span>

<span class="pc bpc" id="L140" title="1 of 2 branches missed.">            if (optionalFacilityVaccineDao.isEmpty()) {</span>
<span class="nc" id="L141">                log.info(&quot;Stock not found&quot;);</span>
<span class="nc" id="L142">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L145">            log.info(&quot;Stock found&quot;);</span>
<span class="fc" id="L146">            FacilityVaccineDto vaccineDto = FacilityVaccineDto.builder()</span>
<span class="fc" id="L147">                    .facilityId(optionalFacilityVaccineDao.get().getFacilityId())</span>
<span class="fc" id="L148">                    .vaccineId(optionalFacilityVaccineDao.get().getVaccineId())</span>
<span class="fc" id="L149">                    .stock(optionalFacilityVaccineDao.get().getStock())</span>
<span class="fc" id="L150">                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L151">                            .id(optionalFacilityVaccineDao.get().getFacility().getId())</span>
<span class="fc" id="L152">                            .facilityName(optionalFacilityVaccineDao.get().getFacility().getFacilityName())</span>
<span class="fc" id="L153">                            .streetName(optionalFacilityVaccineDao.get().getFacility().getStreetName())</span>
<span class="fc" id="L154">                            .officeNumber(optionalFacilityVaccineDao.get().getFacility().getOfficeNumber())</span>
<span class="fc" id="L155">                            .villageName(optionalFacilityVaccineDao.get().getFacility().getVillageName())</span>
<span class="fc" id="L156">                            .district(optionalFacilityVaccineDao.get().getFacility().getDistrict())</span>
<span class="fc" id="L157">                            .city(optionalFacilityVaccineDao.get().getFacility().getCity())</span>
<span class="fc" id="L158">                            .province(optionalFacilityVaccineDao.get().getFacility().getProvince())</span>
<span class="fc" id="L159">                            .postalCode(optionalFacilityVaccineDao.get().getFacility().getPostalCode())</span>
<span class="fc" id="L160">                            .image(HealthFacilityImageDto.builder()</span>
<span class="fc" id="L161">                                    .facilityId(optionalFacilityVaccineDao.get().getFacility().getImage().getFacilityId())</span>
<span class="fc" id="L162">                                    .base64(optionalFacilityVaccineDao.get().getFacility().getImage().getBase64())</span>
<span class="fc" id="L163">                                    .contentType(optionalFacilityVaccineDao.get().getFacility().getImage().getContentType())</span>
<span class="fc" id="L164">                                    .build())</span>
<span class="fc" id="L165">                            .profile(ProfileDto.builder()</span>
<span class="fc" id="L166">                                    .userId(optionalFacilityVaccineDao.get().getFacility().getProfile().getUserId())</span>
<span class="fc" id="L167">                                    .role(optionalFacilityVaccineDao.get().getFacility().getProfile().getRole())</span>
<span class="fc" id="L168">                                    .build())</span>
<span class="fc" id="L169">                            .build())</span>
<span class="fc" id="L170">                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L171">                            .id(optionalFacilityVaccineDao.get().getVaccine().getId())</span>
<span class="fc" id="L172">                            .vaccineName(optionalFacilityVaccineDao.get().getVaccine().getVaccineName())</span>
<span class="fc" id="L173">                            .build())</span>
<span class="fc" id="L174">                    .build();</span>
<span class="fc" id="L175">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, vaccineDto, HttpStatus.OK);</span>
<span class="nc" id="L176">        } catch (Exception e) {</span>
<span class="nc" id="L177">            log.error(&quot;An error occurred in getting a Stock by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L178">            throw e;</span>
        }
    }

    @Transactional
    public ResponseEntity&lt;Object&gt; getAllStocks() {
        try {
<span class="fc" id="L185">            log.info(&quot;Getting all of Stocks&quot;);</span>
            List&lt;FacilityVaccineDao&gt; facilityVaccineDaoList;
<span class="fc" id="L187">            List&lt;FacilityVaccineDto&gt; facilityVaccineDtos = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L189">            facilityVaccineDaoList = stockRepository.findAll();</span>

<span class="fc bfc" id="L191" title="All 2 branches covered.">            for (FacilityVaccineDao facilityVaccineDao : facilityVaccineDaoList) {</span>
<span class="fc" id="L192">                facilityVaccineDtos.add(FacilityVaccineDto.builder()</span>
<span class="fc" id="L193">                                .facilityId(facilityVaccineDao.getFacilityId())</span>
<span class="fc" id="L194">                                .vaccineId(facilityVaccineDao.getVaccineId())</span>
<span class="fc" id="L195">                                .stock(facilityVaccineDao.getStock())</span>
<span class="fc" id="L196">                                .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L197">                                        .id(facilityVaccineDao.getFacility().getId())</span>
<span class="fc" id="L198">                                        .facilityName(facilityVaccineDao.getFacility().getFacilityName())</span>
<span class="fc" id="L199">                                        .streetName(facilityVaccineDao.getFacility().getStreetName())</span>
<span class="fc" id="L200">                                        .officeNumber(facilityVaccineDao.getFacility().getOfficeNumber())</span>
<span class="fc" id="L201">                                        .villageName(facilityVaccineDao.getFacility().getVillageName())</span>
<span class="fc" id="L202">                                        .district(facilityVaccineDao.getFacility().getDistrict())</span>
<span class="fc" id="L203">                                        .city(facilityVaccineDao.getFacility().getCity())</span>
<span class="fc" id="L204">                                        .province(facilityVaccineDao.getFacility().getProvince())</span>
<span class="fc" id="L205">                                        .postalCode(facilityVaccineDao.getFacility().getPostalCode())</span>
<span class="fc" id="L206">                                        .image(HealthFacilityImageDto.builder()</span>
<span class="fc" id="L207">                                                .facilityId(facilityVaccineDao.getFacility().getImage().getFacilityId())</span>
<span class="fc" id="L208">                                                .base64(facilityVaccineDao.getFacility().getImage().getBase64())</span>
<span class="fc" id="L209">                                                .contentType(facilityVaccineDao.getFacility().getImage().getContentType())</span>
<span class="fc" id="L210">                                                .build())</span>
<span class="fc" id="L211">                                        .profile(ProfileDto.builder()</span>
<span class="fc" id="L212">                                                .userId(facilityVaccineDao.getFacility().getProfile().getUserId())</span>
<span class="fc" id="L213">                                                .role(facilityVaccineDao.getFacility().getProfile().getRole())</span>
<span class="fc" id="L214">                                                .build())</span>
<span class="fc" id="L215">                                        .build())</span>
<span class="fc" id="L216">                                .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L217">                                        .id(facilityVaccineDao.getVaccine().getId())</span>
<span class="fc" id="L218">                                        .vaccineName(facilityVaccineDao.getVaccine().getVaccineName())</span>
<span class="fc" id="L219">                                        .build())</span>
<span class="fc" id="L220">                        .build());</span>
<span class="fc" id="L221">            }</span>

<span class="fc" id="L223">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, facilityVaccineDtos, HttpStatus.OK);</span>
<span class="nc" id="L224">        } catch (Exception e) {</span>
<span class="nc" id="L225">            log.error(&quot;An error occurred in getting all of Stocks. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L226">            return ResponseUtil.build(AppConstant.ResponseCode.UNKNOWN_ERROR, null, HttpStatus.INTERNAL_SERVER_ERROR);</span>
        }
    }

    @Transactional
    public ResponseEntity&lt;Object&gt; updateStockById(Long facilityId, Long vaccineId, FacilityVaccineDto facilityVaccineDto) {
        try {
<span class="fc" id="L233">            log.info(&quot;Updating a Stock by id&quot;);</span>
<span class="fc" id="L234">            Optional&lt;FacilityVaccineDao&gt; optionalFacilityVaccineDao = stockRepository.findByFacilityIdAndAndVaccineId(facilityId, vaccineId);</span>

<span class="pc bpc" id="L236" title="1 of 2 branches missed.">            if (optionalFacilityVaccineDao.isEmpty()) {</span>
<span class="nc" id="L237">                log.info(&quot;Stock not found&quot;);</span>
<span class="nc" id="L238">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L241">            log.info(&quot;Stock found&quot;);</span>
<span class="fc" id="L242">            FacilityVaccineDao facilityVaccineDao = optionalFacilityVaccineDao.get();</span>
<span class="fc" id="L243">            facilityVaccineDao.setStock(facilityVaccineDto.getStock());</span>
<span class="fc" id="L244">            stockRepository.save(facilityVaccineDao);</span>

<span class="fc" id="L246">            FacilityVaccineDto vaccineDto = FacilityVaccineDto.builder()</span>
<span class="fc" id="L247">                    .facilityId(optionalFacilityVaccineDao.get().getFacilityId())</span>
<span class="fc" id="L248">                    .vaccineId(optionalFacilityVaccineDao.get().getVaccineId())</span>
<span class="fc" id="L249">                    .stock(facilityVaccineDao.getStock())</span>
<span class="fc" id="L250">                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L251">                            .id(optionalFacilityVaccineDao.get().getFacility().getId())</span>
<span class="fc" id="L252">                            .facilityName(optionalFacilityVaccineDao.get().getFacility().getFacilityName())</span>
<span class="fc" id="L253">                            .streetName(optionalFacilityVaccineDao.get().getFacility().getStreetName())</span>
<span class="fc" id="L254">                            .officeNumber(optionalFacilityVaccineDao.get().getFacility().getOfficeNumber())</span>
<span class="fc" id="L255">                            .villageName(optionalFacilityVaccineDao.get().getFacility().getVillageName())</span>
<span class="fc" id="L256">                            .district(optionalFacilityVaccineDao.get().getFacility().getDistrict())</span>
<span class="fc" id="L257">                            .city(optionalFacilityVaccineDao.get().getFacility().getCity())</span>
<span class="fc" id="L258">                            .province(optionalFacilityVaccineDao.get().getFacility().getProvince())</span>
<span class="fc" id="L259">                            .postalCode(optionalFacilityVaccineDao.get().getFacility().getPostalCode())</span>
<span class="fc" id="L260">                            .image(HealthFacilityImageDto.builder()</span>
<span class="fc" id="L261">                                    .facilityId(optionalFacilityVaccineDao.get().getFacility().getImage().getFacilityId())</span>
<span class="fc" id="L262">                                    .base64(optionalFacilityVaccineDao.get().getFacility().getImage().getBase64())</span>
<span class="fc" id="L263">                                    .contentType(optionalFacilityVaccineDao.get().getFacility().getImage().getContentType())</span>
<span class="fc" id="L264">                                    .build())</span>
<span class="fc" id="L265">                            .profile(ProfileDto.builder()</span>
<span class="fc" id="L266">                                    .userId(optionalFacilityVaccineDao.get().getFacility().getProfile().getUserId())</span>
<span class="fc" id="L267">                                    .role(optionalFacilityVaccineDao.get().getFacility().getProfile().getRole())</span>
<span class="fc" id="L268">                                    .build())</span>
<span class="fc" id="L269">                            .build())</span>
<span class="fc" id="L270">                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L271">                            .id(optionalFacilityVaccineDao.get().getVaccine().getId())</span>
<span class="fc" id="L272">                            .vaccineName(optionalFacilityVaccineDao.get().getVaccine().getVaccineName())</span>
<span class="fc" id="L273">                            .build())</span>
<span class="fc" id="L274">                    .build();</span>
<span class="fc" id="L275">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, vaccineDto, HttpStatus.OK);</span>
<span class="nc" id="L276">        } catch (Exception e) {</span>
<span class="nc" id="L277">            log.error(&quot;An error occurred in Updating Stock by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L278">            throw e;</span>
        }
    }

    public ResponseEntity&lt;Object&gt; deleteStockById(Long facilityId, Long vaccineId) {
        try {
<span class="fc" id="L284">            log.info(&quot;Deleting a Stock by id&quot;);</span>

<span class="fc" id="L286">            Optional&lt;FacilityVaccineDao&gt; optionalFacilityVaccineDao = stockRepository.findByFacilityIdAndAndVaccineId(facilityId, vaccineId);</span>

<span class="pc bpc" id="L288" title="1 of 2 branches missed.">            if (optionalFacilityVaccineDao.isEmpty()) {</span>
<span class="nc" id="L289">                log.info(&quot;Stock not found&quot;);</span>
<span class="nc" id="L290">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L293">            log.info(&quot;Stock found&quot;);</span>
<span class="fc" id="L294">            FacilityVaccineDao facilityVaccineDao = optionalFacilityVaccineDao.get();</span>
<span class="fc" id="L295">            facilityVaccineDao.setStock(0);</span>
<span class="fc" id="L296">            stockRepository.save(facilityVaccineDao);</span>

<span class="fc" id="L298">            FacilityVaccineDto vaccineDto = FacilityVaccineDto.builder()</span>
<span class="fc" id="L299">                    .facilityId(optionalFacilityVaccineDao.get().getFacilityId())</span>
<span class="fc" id="L300">                    .vaccineId(optionalFacilityVaccineDao.get().getVaccineId())</span>
<span class="fc" id="L301">                    .stock(facilityVaccineDao.getStock())</span>
<span class="fc" id="L302">                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L303">                            .id(optionalFacilityVaccineDao.get().getFacility().getId())</span>
<span class="fc" id="L304">                            .facilityName(optionalFacilityVaccineDao.get().getFacility().getFacilityName())</span>
<span class="fc" id="L305">                            .streetName(optionalFacilityVaccineDao.get().getFacility().getStreetName())</span>
<span class="fc" id="L306">                            .officeNumber(optionalFacilityVaccineDao.get().getFacility().getOfficeNumber())</span>
<span class="fc" id="L307">                            .villageName(optionalFacilityVaccineDao.get().getFacility().getVillageName())</span>
<span class="fc" id="L308">                            .district(optionalFacilityVaccineDao.get().getFacility().getDistrict())</span>
<span class="fc" id="L309">                            .city(optionalFacilityVaccineDao.get().getFacility().getCity())</span>
<span class="fc" id="L310">                            .province(optionalFacilityVaccineDao.get().getFacility().getProvince())</span>
<span class="fc" id="L311">                            .postalCode(optionalFacilityVaccineDao.get().getFacility().getPostalCode())</span>
<span class="fc" id="L312">                            .image(HealthFacilityImageDto.builder()</span>
<span class="fc" id="L313">                                    .facilityId(optionalFacilityVaccineDao.get().getFacility().getImage().getFacilityId())</span>
<span class="fc" id="L314">                                    .base64(optionalFacilityVaccineDao.get().getFacility().getImage().getBase64())</span>
<span class="fc" id="L315">                                    .contentType(optionalFacilityVaccineDao.get().getFacility().getImage().getContentType())</span>
<span class="fc" id="L316">                                    .build())</span>
<span class="fc" id="L317">                            .profile(ProfileDto.builder()</span>
<span class="fc" id="L318">                                    .userId(optionalFacilityVaccineDao.get().getFacility().getProfile().getUserId())</span>
<span class="fc" id="L319">                                    .role(optionalFacilityVaccineDao.get().getFacility().getProfile().getRole())</span>
<span class="fc" id="L320">                                    .build())</span>
<span class="fc" id="L321">                            .build())</span>
<span class="fc" id="L322">                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L323">                            .id(optionalFacilityVaccineDao.get().getVaccine().getId())</span>
<span class="fc" id="L324">                            .vaccineName(optionalFacilityVaccineDao.get().getVaccine().getVaccineName())</span>
<span class="fc" id="L325">                            .build())</span>
<span class="fc" id="L326">                    .build();</span>

<span class="fc" id="L328">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, vaccineDto, HttpStatus.OK);</span>
<span class="nc" id="L329">        } catch (Exception e) {</span>
<span class="nc" id="L330">            log.error(&quot;An error occurred in deleting Stock by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L331">            throw e;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>