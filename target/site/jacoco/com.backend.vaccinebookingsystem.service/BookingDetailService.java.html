<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BookingDetailService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">vaccine-booking-system</a> &gt; <a href="index.source.html" class="el_package">com.backend.vaccinebookingsystem.service</a> &gt; <span class="el_source">BookingDetailService.java</span></div><h1>BookingDetailService.java</h1><pre class="source lang-java linenums">package com.backend.vaccinebookingsystem.service;

import com.backend.vaccinebookingsystem.constant.AppConstant;
import com.backend.vaccinebookingsystem.domain.dao.BookingDao;
import com.backend.vaccinebookingsystem.domain.dao.BookingDetailDao;
import com.backend.vaccinebookingsystem.domain.dao.FamilyDao;
import com.backend.vaccinebookingsystem.domain.dto.*;
import com.backend.vaccinebookingsystem.repository.BookingDetailRepository;
import com.backend.vaccinebookingsystem.repository.BookingRepository;
import com.backend.vaccinebookingsystem.repository.FamilyRepository;
import com.backend.vaccinebookingsystem.util.ResponseUtil;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

<span class="fc" id="L23">@Slf4j</span>
@Service
<span class="fc" id="L25">public class BookingDetailService {</span>

    @Autowired
    private BookingDetailRepository bookingDetailRepository;

    @Autowired
    private BookingRepository bookingRepository;

    @Autowired
    private FamilyRepository familyRepository;

    public ResponseEntity&lt;Object&gt; createBookingDetail(BookingDetailDto bookingDetailDto) {
        try {
<span class="fc" id="L38">            log.info(&quot;Creating new Booking Detail&quot;);</span>
<span class="fc" id="L39">            Optional&lt;BookingDao&gt; optionalBookingDao = bookingRepository.findById(bookingDetailDto.getBookingId());</span>

<span class="fc" id="L41">            Optional&lt;FamilyDao&gt; optionalFamilyDao = familyRepository.findById(bookingDetailDto.getFamilyId());</span>

<span class="pc bpc" id="L43" title="2 of 4 branches missed.">            if (optionalBookingDao.isEmpty() || optionalFamilyDao.isEmpty()) {</span>
<span class="nc" id="L44">                log.info(&quot;Booking Detail not found&quot;);</span>
<span class="nc" id="L45">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L48">            log.info(&quot;Booking Detail found&quot;);</span>
<span class="fc" id="L49">            BookingDetailDao bookingDetailDao = BookingDetailDao.builder()</span>
<span class="fc" id="L50">                    .bookingId(bookingDetailDto.getBookingId())</span>
<span class="fc" id="L51">                    .familyId(bookingDetailDto.getFamilyId())</span>
<span class="fc" id="L52">                    .bookingStatus(bookingDetailDto.getBookingStatus())</span>
<span class="fc" id="L53">                    .build();</span>

<span class="fc" id="L55">            bookingDetailRepository.save(bookingDetailDao);</span>

<span class="fc" id="L57">            BookingDetailDto detailDto = BookingDetailDto.builder()</span>
<span class="fc" id="L58">                    .bookingId(bookingDetailDao.getBookingId())</span>
<span class="fc" id="L59">                    .familyId(bookingDetailDao.getFamilyId())</span>
<span class="fc" id="L60">                    .bookingStatus(bookingDetailDao.getBookingStatus())</span>
<span class="fc" id="L61">                    .family(FamilyDto.builder()</span>
<span class="fc" id="L62">                            .id(optionalFamilyDao.get().getId())</span>
<span class="fc" id="L63">                            .statusInFamily(optionalFamilyDao.get().getStatusInFamily())</span>
<span class="fc" id="L64">                            .NIK(optionalFamilyDao.get().getNIK())</span>
<span class="fc" id="L65">                            .name(optionalFamilyDao.get().getName())</span>
<span class="fc" id="L66">                            .email(optionalFamilyDao.get().getEmail())</span>
<span class="fc" id="L67">                            .phoneNumber(optionalFamilyDao.get().getPhoneNumber())</span>
<span class="fc" id="L68">                            .gender(optionalFamilyDao.get().getGender())</span>
<span class="fc" id="L69">                            .placeOfBirth(optionalFamilyDao.get().getPlaceOfBirth())</span>
<span class="fc" id="L70">                            .dateOfBirth(optionalFamilyDao.get().getDateOfBirth())</span>
<span class="fc" id="L71">                            .residenceAddress(optionalFamilyDao.get().getResidenceAddress())</span>
<span class="fc" id="L72">                            .idCardAddress(optionalFamilyDao.get().getIdCardAddress())</span>
<span class="fc" id="L73">                            .build())</span>
<span class="fc" id="L74">                    .booking(BookingDto.builder()</span>
<span class="fc" id="L75">                            .id(optionalBookingDao.get().getId())</span>
<span class="fc" id="L76">                            .bookingPass(optionalBookingDao.get().getBookingPass())</span>
<span class="fc" id="L77">                            .bookingDate(optionalBookingDao.get().getBookingDate())</span>
<span class="fc" id="L78">                            .user(UserDto.builder()</span>
<span class="fc" id="L79">                                    .id(optionalBookingDao.get().getUser().getId())</span>
<span class="fc" id="L80">                                    .username(optionalBookingDao.get().getUser().getUsername())</span>
<span class="fc" id="L81">                                    .name(optionalBookingDao.get().getUser().getName())</span>
<span class="fc" id="L82">                                    .email(optionalBookingDao.get().getUser().getEmail())</span>
<span class="fc" id="L83">                                    .build())</span>
<span class="fc" id="L84">                            .schedule(ScheduleDto.builder()</span>
<span class="fc" id="L85">                                    .id(optionalBookingDao.get().getSchedule().getId())</span>
<span class="fc" id="L86">                                    .vaccinationDate(optionalBookingDao.get().getSchedule().getVaccinationDate())</span>
<span class="fc" id="L87">                                    .operationalHourStart(optionalBookingDao.get().getSchedule().getOperationalHourStart())</span>
<span class="fc" id="L88">                                    .operationalHourEnd(optionalBookingDao.get().getSchedule().getOperationalHourEnd())</span>
<span class="fc" id="L89">                                    .quota(optionalBookingDao.get().getSchedule().getQuota())</span>
<span class="fc" id="L90">                                    .dose(optionalBookingDao.get().getSchedule().getDose())</span>
<span class="fc" id="L91">                                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L92">                                            .id(optionalBookingDao.get().getSchedule().getFacility().getId())</span>
<span class="fc" id="L93">                                            .facilityName(optionalBookingDao.get().getSchedule().getFacility().getFacilityName())</span>
<span class="fc" id="L94">                                            .streetName(optionalBookingDao.get().getSchedule().getFacility().getStreetName())</span>
<span class="fc" id="L95">                                            .officeNumber(optionalBookingDao.get().getSchedule().getFacility().getOfficeNumber())</span>
<span class="fc" id="L96">                                            .villageName(optionalBookingDao.get().getSchedule().getFacility().getVillageName())</span>
<span class="fc" id="L97">                                            .district(optionalBookingDao.get().getSchedule().getFacility().getDistrict())</span>
<span class="fc" id="L98">                                            .city(optionalBookingDao.get().getSchedule().getFacility().getCity())</span>
<span class="fc" id="L99">                                            .province(optionalBookingDao.get().getSchedule().getFacility().getProvince())</span>
<span class="fc" id="L100">                                            .postalCode(optionalBookingDao.get().getSchedule().getFacility().getPostalCode())</span>
<span class="fc" id="L101">                                            .build())</span>
<span class="fc" id="L102">                                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L103">                                            .id(optionalBookingDao.get().getSchedule().getVaccine().getId())</span>
<span class="fc" id="L104">                                            .vaccineName(optionalBookingDao.get().getSchedule().getVaccine().getVaccineName())</span>
<span class="fc" id="L105">                                            .build())</span>
<span class="fc" id="L106">                                    .build())</span>
<span class="fc" id="L107">                            .build())</span>
<span class="fc" id="L108">                    .build();</span>

<span class="fc" id="L110">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, detailDto, HttpStatus.OK);</span>
<span class="nc" id="L111">        } catch (Exception e) {</span>
<span class="nc" id="L112">            log.error(&quot;An error occurred in creating new Booking Detail. Error: {}&quot;, e.getMessage());</span>
<span class="nc" id="L113">            return ResponseUtil.build(AppConstant.ResponseCode.UNKNOWN_ERROR, null, HttpStatus.INTERNAL_SERVER_ERROR);</span>
        }
    }

    @Transactional
    public ResponseEntity&lt;Object&gt; searchBookingDetailById(Long bookingId, Long familyId) {
        try {
<span class="fc" id="L120">            log.info(&quot;Getting a Booking Detail by id&quot;);</span>
<span class="fc" id="L121">            Optional&lt;BookingDetailDao&gt; optionalBookingDetailDao = bookingDetailRepository.findByBookingIdAndFamilyId(bookingId, familyId);</span>

<span class="pc bpc" id="L123" title="1 of 2 branches missed.">            if (optionalBookingDetailDao.isEmpty()) {</span>
<span class="nc" id="L124">                log.info(&quot;Booking Detail not found&quot;);</span>
<span class="nc" id="L125">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L128">            log.info(&quot;Booking Detail found&quot;);</span>
<span class="fc" id="L129">            BookingDetailDto detailDto = BookingDetailDto.builder()</span>
<span class="fc" id="L130">                    .bookingId(optionalBookingDetailDao.get().getBookingId())</span>
<span class="fc" id="L131">                    .familyId(optionalBookingDetailDao.get().getFamilyId())</span>
<span class="fc" id="L132">                    .bookingStatus(optionalBookingDetailDao.get().getBookingStatus())</span>
<span class="fc" id="L133">                    .family(FamilyDto.builder()</span>
<span class="fc" id="L134">                            .id(optionalBookingDetailDao.get().getFamily().getId())</span>
<span class="fc" id="L135">                            .statusInFamily(optionalBookingDetailDao.get().getFamily().getStatusInFamily())</span>
<span class="fc" id="L136">                            .NIK(optionalBookingDetailDao.get().getFamily().getNIK())</span>
<span class="fc" id="L137">                            .name(optionalBookingDetailDao.get().getFamily().getName())</span>
<span class="fc" id="L138">                            .email(optionalBookingDetailDao.get().getFamily().getEmail())</span>
<span class="fc" id="L139">                            .phoneNumber(optionalBookingDetailDao.get().getFamily().getPhoneNumber())</span>
<span class="fc" id="L140">                            .gender(optionalBookingDetailDao.get().getFamily().getGender())</span>
<span class="fc" id="L141">                            .placeOfBirth(optionalBookingDetailDao.get().getFamily().getPlaceOfBirth())</span>
<span class="fc" id="L142">                            .dateOfBirth(optionalBookingDetailDao.get().getFamily().getDateOfBirth())</span>
<span class="fc" id="L143">                            .residenceAddress(optionalBookingDetailDao.get().getFamily().getResidenceAddress())</span>
<span class="fc" id="L144">                            .idCardAddress(optionalBookingDetailDao.get().getFamily().getIdCardAddress())</span>
<span class="fc" id="L145">                            .build())</span>
<span class="fc" id="L146">                    .booking(BookingDto.builder()</span>
<span class="fc" id="L147">                            .id(optionalBookingDetailDao.get().getBooking().getId())</span>
<span class="fc" id="L148">                            .bookingPass(optionalBookingDetailDao.get().getBooking().getBookingPass())</span>
<span class="fc" id="L149">                            .bookingDate(optionalBookingDetailDao.get().getBooking().getBookingDate())</span>
<span class="fc" id="L150">                            .user(UserDto.builder()</span>
<span class="fc" id="L151">                                    .id(optionalBookingDetailDao.get().getBooking().getUser().getId())</span>
<span class="fc" id="L152">                                    .username(optionalBookingDetailDao.get().getBooking().getUser().getUsername())</span>
<span class="fc" id="L153">                                    .name(optionalBookingDetailDao.get().getBooking().getUser().getName())</span>
<span class="fc" id="L154">                                    .email(optionalBookingDetailDao.get().getBooking().getUser().getEmail())</span>
<span class="fc" id="L155">                                    .build())</span>
<span class="fc" id="L156">                            .schedule(ScheduleDto.builder()</span>
<span class="fc" id="L157">                                    .id(optionalBookingDetailDao.get().getBooking().getSchedule().getId())</span>
<span class="fc" id="L158">                                    .vaccinationDate(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccinationDate())</span>
<span class="fc" id="L159">                                    .operationalHourStart(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourStart())</span>
<span class="fc" id="L160">                                    .operationalHourEnd(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourEnd())</span>
<span class="fc" id="L161">                                    .quota(optionalBookingDetailDao.get().getBooking().getSchedule().getQuota())</span>
<span class="fc" id="L162">                                    .dose(optionalBookingDetailDao.get().getBooking().getSchedule().getDose())</span>
<span class="fc" id="L163">                                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L164">                                            .id(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getId())</span>
<span class="fc" id="L165">                                            .facilityName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getFacilityName())</span>
<span class="fc" id="L166">                                            .streetName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getStreetName())</span>
<span class="fc" id="L167">                                            .officeNumber(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getOfficeNumber())</span>
<span class="fc" id="L168">                                            .villageName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getVillageName())</span>
<span class="fc" id="L169">                                            .district(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getDistrict())</span>
<span class="fc" id="L170">                                            .city(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getCity())</span>
<span class="fc" id="L171">                                            .province(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getProvince())</span>
<span class="fc" id="L172">                                            .postalCode(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getPostalCode())</span>
<span class="fc" id="L173">                                            .build())</span>
<span class="fc" id="L174">                                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L175">                                            .id(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getId())</span>
<span class="fc" id="L176">                                            .vaccineName(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getVaccineName())</span>
<span class="fc" id="L177">                                            .build())</span>
<span class="fc" id="L178">                                    .build())</span>
<span class="fc" id="L179">                            .build())</span>
<span class="fc" id="L180">                    .build();</span>
<span class="fc" id="L181">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, detailDto, HttpStatus.OK);</span>
<span class="nc" id="L182">        } catch (Exception e) {</span>
<span class="nc" id="L183">            log.error(&quot;An error occurred in getting a Booking Detail by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L184">            throw e;</span>
        }
    }

    public ResponseEntity&lt;Object&gt; getAllBookingDetails() {
        try {
<span class="fc" id="L190">            log.info(&quot;Getting all of Booking Details&quot;);</span>
            List&lt;BookingDetailDao&gt; bookingDetailDaoList;
<span class="fc" id="L192">            List&lt;BookingDetailDto&gt; bookingDetailDtos = new ArrayList&lt;&gt;();</span>

<span class="fc" id="L194">            bookingDetailDaoList = bookingDetailRepository.findAll();</span>

<span class="fc bfc" id="L196" title="All 2 branches covered.">            for (BookingDetailDao bookingDetailDao : bookingDetailDaoList) {</span>
<span class="fc" id="L197">                Optional&lt;BookingDetailDao&gt; optionalBookingDetailDao = bookingDetailRepository.findByBookingIdAndFamilyId(bookingDetailDao.getBookingId(), bookingDetailDao.getFamilyId());</span>

<span class="fc" id="L199">                bookingDetailDtos.add(BookingDetailDto.builder()</span>
<span class="fc" id="L200">                        .bookingId(bookingDetailDao.getBookingId())</span>
<span class="fc" id="L201">                        .familyId(bookingDetailDao.getFamilyId())</span>
<span class="fc" id="L202">                        .bookingStatus(bookingDetailDao.getBookingStatus())</span>
<span class="fc" id="L203">                        .family(FamilyDto.builder()</span>
<span class="fc" id="L204">                                .id(optionalBookingDetailDao.get().getFamily().getId())</span>
<span class="fc" id="L205">                                .statusInFamily(optionalBookingDetailDao.get().getFamily().getStatusInFamily())</span>
<span class="fc" id="L206">                                .NIK(optionalBookingDetailDao.get().getFamily().getNIK())</span>
<span class="fc" id="L207">                                .name(optionalBookingDetailDao.get().getFamily().getName())</span>
<span class="fc" id="L208">                                .email(optionalBookingDetailDao.get().getFamily().getEmail())</span>
<span class="fc" id="L209">                                .phoneNumber(optionalBookingDetailDao.get().getFamily().getPhoneNumber())</span>
<span class="fc" id="L210">                                .gender(optionalBookingDetailDao.get().getFamily().getGender())</span>
<span class="fc" id="L211">                                .placeOfBirth(optionalBookingDetailDao.get().getFamily().getPlaceOfBirth())</span>
<span class="fc" id="L212">                                .dateOfBirth(optionalBookingDetailDao.get().getFamily().getDateOfBirth())</span>
<span class="fc" id="L213">                                .residenceAddress(optionalBookingDetailDao.get().getFamily().getResidenceAddress())</span>
<span class="fc" id="L214">                                .idCardAddress(optionalBookingDetailDao.get().getFamily().getIdCardAddress())</span>
<span class="fc" id="L215">                                .build())</span>
<span class="fc" id="L216">                        .booking(BookingDto.builder()</span>
<span class="fc" id="L217">                                .id(optionalBookingDetailDao.get().getBooking().getId())</span>
<span class="fc" id="L218">                                .bookingPass(optionalBookingDetailDao.get().getBooking().getBookingPass())</span>
<span class="fc" id="L219">                                .bookingDate(optionalBookingDetailDao.get().getBooking().getBookingDate())</span>
<span class="fc" id="L220">                                .user(UserDto.builder()</span>
<span class="fc" id="L221">                                        .id(optionalBookingDetailDao.get().getBooking().getUser().getId())</span>
<span class="fc" id="L222">                                        .username(optionalBookingDetailDao.get().getBooking().getUser().getUsername())</span>
<span class="fc" id="L223">                                        .name(optionalBookingDetailDao.get().getBooking().getUser().getName())</span>
<span class="fc" id="L224">                                        .email(optionalBookingDetailDao.get().getBooking().getUser().getEmail())</span>
<span class="fc" id="L225">                                        .build())</span>
<span class="fc" id="L226">                                .schedule(ScheduleDto.builder()</span>
<span class="fc" id="L227">                                        .id(optionalBookingDetailDao.get().getBooking().getSchedule().getId())</span>
<span class="fc" id="L228">                                        .vaccinationDate(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccinationDate())</span>
<span class="fc" id="L229">                                        .operationalHourStart(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourStart())</span>
<span class="fc" id="L230">                                        .operationalHourEnd(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourEnd())</span>
<span class="fc" id="L231">                                        .quota(optionalBookingDetailDao.get().getBooking().getSchedule().getQuota())</span>
<span class="fc" id="L232">                                        .dose(optionalBookingDetailDao.get().getBooking().getSchedule().getDose())</span>
<span class="fc" id="L233">                                        .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L234">                                                .id(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getId())</span>
<span class="fc" id="L235">                                                .facilityName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getFacilityName())</span>
<span class="fc" id="L236">                                                .streetName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getStreetName())</span>
<span class="fc" id="L237">                                                .officeNumber(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getOfficeNumber())</span>
<span class="fc" id="L238">                                                .villageName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getVillageName())</span>
<span class="fc" id="L239">                                                .district(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getDistrict())</span>
<span class="fc" id="L240">                                                .city(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getCity())</span>
<span class="fc" id="L241">                                                .province(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getProvince())</span>
<span class="fc" id="L242">                                                .postalCode(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getPostalCode())</span>
<span class="fc" id="L243">                                                .build())</span>
<span class="fc" id="L244">                                        .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L245">                                                .id(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getId())</span>
<span class="fc" id="L246">                                                .vaccineName(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getVaccineName())</span>
<span class="fc" id="L247">                                                .build())</span>
<span class="fc" id="L248">                                        .build())</span>
<span class="fc" id="L249">                                .build())</span>
<span class="fc" id="L250">                        .build());</span>
<span class="fc" id="L251">            }</span>

<span class="fc" id="L253">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, bookingDetailDtos, HttpStatus.OK);</span>
<span class="nc" id="L254">        } catch (Exception e) {</span>
<span class="nc" id="L255">            log.error(&quot;An error occurred in getting all of Booking Details. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L256">            return ResponseUtil.build(AppConstant.ResponseCode.UNKNOWN_ERROR, null, HttpStatus.INTERNAL_SERVER_ERROR);</span>
        }
    }

    @Transactional
    public ResponseEntity&lt;Object&gt; updateBookingDetailById(Long bookingId, Long familyId, BookingDetailDto bookingDetailDto) {
        try {
<span class="fc" id="L263">            log.info(&quot;Updating a Booking Detail by id&quot;);</span>

<span class="fc" id="L265">            Optional&lt;BookingDetailDao&gt; optionalBookingDetailDao = bookingDetailRepository.findByBookingIdAndFamilyId(bookingId, familyId);</span>

<span class="pc bpc" id="L267" title="1 of 2 branches missed.">            if (optionalBookingDetailDao.isEmpty()) {</span>
<span class="nc" id="L268">                log.info(&quot;Booking Detail not found&quot;);</span>
<span class="nc" id="L269">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L272">            log.info(&quot;Booking Detail found&quot;);</span>
<span class="fc" id="L273">            BookingDetailDao bookingDetailDao = optionalBookingDetailDao.get();</span>
<span class="fc" id="L274">            bookingDetailDao.setBookingStatus(bookingDetailDto.getBookingStatus());</span>
<span class="fc" id="L275">            bookingDetailRepository.save(bookingDetailDao);</span>

<span class="fc" id="L277">            BookingDetailDto detailDto = BookingDetailDto.builder()</span>
<span class="fc" id="L278">                    .bookingId(bookingDetailDao.getBookingId())</span>
<span class="fc" id="L279">                    .familyId(bookingDetailDao.getFamilyId())</span>
<span class="fc" id="L280">                    .bookingStatus(bookingDetailDao.getBookingStatus())</span>
<span class="fc" id="L281">                    .family(FamilyDto.builder()</span>
<span class="fc" id="L282">                            .id(optionalBookingDetailDao.get().getFamily().getId())</span>
<span class="fc" id="L283">                            .statusInFamily(optionalBookingDetailDao.get().getFamily().getStatusInFamily())</span>
<span class="fc" id="L284">                            .NIK(optionalBookingDetailDao.get().getFamily().getNIK())</span>
<span class="fc" id="L285">                            .name(optionalBookingDetailDao.get().getFamily().getName())</span>
<span class="fc" id="L286">                            .email(optionalBookingDetailDao.get().getFamily().getEmail())</span>
<span class="fc" id="L287">                            .phoneNumber(optionalBookingDetailDao.get().getFamily().getPhoneNumber())</span>
<span class="fc" id="L288">                            .gender(optionalBookingDetailDao.get().getFamily().getGender())</span>
<span class="fc" id="L289">                            .placeOfBirth(optionalBookingDetailDao.get().getFamily().getPlaceOfBirth())</span>
<span class="fc" id="L290">                            .dateOfBirth(optionalBookingDetailDao.get().getFamily().getDateOfBirth())</span>
<span class="fc" id="L291">                            .residenceAddress(optionalBookingDetailDao.get().getFamily().getResidenceAddress())</span>
<span class="fc" id="L292">                            .idCardAddress(optionalBookingDetailDao.get().getFamily().getIdCardAddress())</span>
<span class="fc" id="L293">                            .build())</span>
<span class="fc" id="L294">                    .booking(BookingDto.builder()</span>
<span class="fc" id="L295">                            .id(optionalBookingDetailDao.get().getBooking().getId())</span>
<span class="fc" id="L296">                            .bookingPass(optionalBookingDetailDao.get().getBooking().getBookingPass())</span>
<span class="fc" id="L297">                            .bookingDate(optionalBookingDetailDao.get().getBooking().getBookingDate())</span>
<span class="fc" id="L298">                            .user(UserDto.builder()</span>
<span class="fc" id="L299">                                    .id(optionalBookingDetailDao.get().getBooking().getUser().getId())</span>
<span class="fc" id="L300">                                    .username(optionalBookingDetailDao.get().getBooking().getUser().getUsername())</span>
<span class="fc" id="L301">                                    .name(optionalBookingDetailDao.get().getBooking().getUser().getName())</span>
<span class="fc" id="L302">                                    .email(optionalBookingDetailDao.get().getBooking().getUser().getEmail())</span>
<span class="fc" id="L303">                                    .build())</span>
<span class="fc" id="L304">                            .schedule(ScheduleDto.builder()</span>
<span class="fc" id="L305">                                    .id(optionalBookingDetailDao.get().getBooking().getSchedule().getId())</span>
<span class="fc" id="L306">                                    .vaccinationDate(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccinationDate())</span>
<span class="fc" id="L307">                                    .operationalHourStart(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourStart())</span>
<span class="fc" id="L308">                                    .operationalHourEnd(optionalBookingDetailDao.get().getBooking().getSchedule().getOperationalHourEnd())</span>
<span class="fc" id="L309">                                    .quota(optionalBookingDetailDao.get().getBooking().getSchedule().getQuota())</span>
<span class="fc" id="L310">                                    .dose(optionalBookingDetailDao.get().getBooking().getSchedule().getDose())</span>
<span class="fc" id="L311">                                    .facility(HealthFacilityDto.builder()</span>
<span class="fc" id="L312">                                            .id(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getId())</span>
<span class="fc" id="L313">                                            .facilityName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getFacilityName())</span>
<span class="fc" id="L314">                                            .streetName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getStreetName())</span>
<span class="fc" id="L315">                                            .officeNumber(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getOfficeNumber())</span>
<span class="fc" id="L316">                                            .villageName(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getVillageName())</span>
<span class="fc" id="L317">                                            .district(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getDistrict())</span>
<span class="fc" id="L318">                                            .city(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getCity())</span>
<span class="fc" id="L319">                                            .province(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getProvince())</span>
<span class="fc" id="L320">                                            .postalCode(optionalBookingDetailDao.get().getBooking().getSchedule().getFacility().getPostalCode())</span>
<span class="fc" id="L321">                                            .build())</span>
<span class="fc" id="L322">                                    .vaccine(VaccineTypeDto.builder()</span>
<span class="fc" id="L323">                                            .id(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getId())</span>
<span class="fc" id="L324">                                            .vaccineName(optionalBookingDetailDao.get().getBooking().getSchedule().getVaccine().getVaccineName())</span>
<span class="fc" id="L325">                                            .build())</span>
<span class="fc" id="L326">                                    .build())</span>
<span class="fc" id="L327">                            .build())</span>
<span class="fc" id="L328">                    .build();</span>
<span class="fc" id="L329">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, detailDto, HttpStatus.OK);</span>
<span class="nc" id="L330">        } catch (Exception e) {</span>
<span class="nc" id="L331">            log.error(&quot;An error occurred in Updating Booking Detail by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L332">            throw e;</span>
        }
    }

    public ResponseEntity&lt;Object&gt; deleteBookingDetailById(Long bookingId, Long familyId) {
        try {
<span class="fc" id="L338">            log.info(&quot;Deleting a Booking Detail by id&quot;);</span>
<span class="fc" id="L339">            Optional&lt;BookingDetailDao&gt; optionalBookingDetailDao = bookingDetailRepository.findByBookingIdAndFamilyId(bookingId, familyId);</span>

<span class="pc bpc" id="L341" title="1 of 2 branches missed.">            if (optionalBookingDetailDao.isEmpty()) {</span>
<span class="nc" id="L342">                log.info(&quot;Booking Detail not found&quot;);</span>
<span class="nc" id="L343">                return ResponseUtil.build(AppConstant.ResponseCode.DATA_NOT_FOUND, null, HttpStatus.BAD_REQUEST);</span>
            }

<span class="fc" id="L346">            log.info(&quot;Stock found&quot;);</span>
<span class="fc" id="L347">            bookingDetailRepository.delete(optionalBookingDetailDao.get());</span>
<span class="fc" id="L348">            return ResponseUtil.build(AppConstant.ResponseCode.SUCCESS, null, HttpStatus.OK);</span>
<span class="nc" id="L349">        } catch (Exception e) {</span>
<span class="nc" id="L350">            log.error(&quot;An error occurred in deleting Stock by id. Error {}&quot;, e.getMessage());</span>
<span class="nc" id="L351">            throw e;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>